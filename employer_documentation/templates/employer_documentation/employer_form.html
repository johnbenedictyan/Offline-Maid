{% extends 'dashboard-base.html' %}

{% block dashboard_section %}
    {% if form.errors %}
        {% for field in form %}
            {% for error in field.errors %}
            <div class="alert alert-danger">
                <strong>{{ error|escape }}</strong>
            </div>
            {% endfor %}
        {% endfor %}
    {% endif %}
    
    <div class="container">
        {% block form %}{% endblock form %}
    </div>
{% endblock dashboard_section %}

{% block js %}
    <script>
        // Employer create/update
        let applicantType = document.getElementById('id_applicant_type');
        let employerMaritalStatus = document.getElementById('id_employer_marital_status');
        if (applicantType && employerMaritalStatus) {
            let spouseSection = document.getElementById('spouse-section');
            // On page load
            if (employerMaritalStatus.value=='MARRIED') {
                spouseSection.hidden = false; // show
            } else {
                spouseSection.hidden = true; // hide
            }

            // On employerMaritalStatus change
            employerMaritalStatus.addEventListener('change', function() {
                if (this.value=='MARRIED') {
                    spouseSection.hidden = false; // show
                } else {
                    spouseSection.hidden = true; // hide
                }
            })

            // On applicantType change
            applicantType.addEventListener('change', function() {
                if (this.value=='SPOUSE') {
                    spouseSection.hidden = false; // show
                    employerMaritalStatus.value = 'MARRIED';
                }
            })
        }
        let employerResidentialStatus = document.getElementById('id_employer_residential_status');
        if (employerResidentialStatus) {
            let employerIdNric = document.getElementById('employer_id_nric');
            let employerIdOther = document.getElementById('employer_id_other');
            // On page load
            if (employerResidentialStatus.value=='SC' || employerResidentialStatus.value=='PR' ) {
                employerIdNric.hidden = false; // show
                employerIdOther.hidden = true; // hide
            } else {
                employerIdNric.hidden = true; // hide
                employerIdOther.hidden = false; // show
            }

            // On employerResidentialStatus change
            employerResidentialStatus.addEventListener('change', function() {
                if (this.value=='SC' || this.value=='PR') {
                    employerIdNric.hidden = false; // show
                    employerIdOther.hidden = true; // hide
                } else {
                    employerIdNric.hidden = true; // hide
                    employerIdOther.hidden = false; // show
                }
            })
        }
        let spouseResidentialStatus = document.getElementById('id_spouse_residential_status');
        if (spouseResidentialStatus) {
            let spouseIdNric = document.getElementById('spouse_id_nric');
            let spouseIdOther = document.getElementById('spouse_id_other');
            // On page load
            if (spouseResidentialStatus.value=='SC' || spouseResidentialStatus.value=='PR' ) {
                spouseIdNric.hidden = false; // show
                spouseIdOther.hidden = true; // hide
            } else {
                spouseIdNric.hidden = true; // hide
                spouseIdOther.hidden = false; // show
            }

            // On spouseResidentialStatus change
            spouseResidentialStatus.addEventListener('change', function() {
                if (this.value=='SC' || this.value=='PR') {
                    spouseIdNric.hidden = false; // show
                    spouseIdOther.hidden = true; // hide
                } else {
                    spouseIdNric.hidden = true; // hide
                    spouseIdOther.hidden = false; // show
                }
            })
        }

        // Sponsor create/update
        let toggleSponsor2 = document.getElementById('id_sponsor_2_required');
        if (toggleSponsor2) {
            let sponsor2 = document.getElementById('sponsor_2');
            // On page load
            if (toggleSponsor2.value=='True') {
                sponsor2.hidden = false; // show
            } else {
                sponsor2.hidden = true; // hide
            }

            // On toggleSponsor2 change
            toggleSponsor2.addEventListener('change', function() {
                if (this.value=='True') {
                    sponsor2.hidden = false; // show
                } else {
                    sponsor2.hidden = true; // hide
                }
            })
        }
        let sponsor1MaritalStatus = document.getElementById('id_sponsor_1_marital_status');
        if (sponsor1MaritalStatus) {
            let sponsor1spouseSection = document.getElementById('sponsor_1_spouse');
            // On page load
            if (sponsor1MaritalStatus.value=='MARRIED') {
                sponsor1spouseSection.hidden = false; // show
            } else {
                sponsor1spouseSection.hidden = true; // hide
            }

            // On sponsor1MaritalStatus change
            sponsor1MaritalStatus.addEventListener('change', function() {
                if (this.value=='MARRIED') {
                    sponsor1spouseSection.hidden = false; // show
                } else {
                    sponsor1spouseSection.hidden = true; // hide
                }
            })
        }
        let sponsor1spouseResidentialStatus = document.getElementById('id_sponsor_1_spouse_residential_status');
        if (sponsor1spouseResidentialStatus) {
            let sponsor1spouseIdNric = document.getElementById('sponsor1spouse_id_nric');
            let sponsor1spouseIdFin = document.getElementById('sponsor1spouse_id_fin');
            let sponsor1spouseIdPassport = document.getElementById('sponsor1spouse_id_passport');
            // On page load
            if (sponsor1spouseResidentialStatus.value=='SC' || sponsor1spouseResidentialStatus.value=='PR' ) {
                sponsor1spouseIdNric.hidden = false; // show
                sponsor1spouseIdFin.hidden = true; // hide
                sponsor1spouseIdPassport.hidden = true; // hide
            } else {
                sponsor1spouseIdNric.hidden = true; // hide
                sponsor1spouseIdFin.hidden = false; // show
                sponsor1spouseIdPassport.hidden = false; // show
            }

            // On sponsor1spouseResidentialStatus change
            sponsor1spouseResidentialStatus.addEventListener('change', function() {
                if (this.value=='SC' || this.value=='PR') {
                    sponsor1spouseIdNric.hidden = false; // show
                    sponsor1spouseIdFin.hidden = true; // hide
                    sponsor1spouseIdPassport.hidden = true; // hide
                } else {
                    sponsor1spouseIdNric.hidden = true; // hide
                    sponsor1spouseIdFin.hidden = false; // show
                    sponsor1spouseIdPassport.hidden = false; // show
                }
            })
        }
        let sponsor2MaritalStatus = document.getElementById('id_sponsor_2_marital_status');
        if (sponsor2MaritalStatus) {
            let sponsor2spouseSection = document.getElementById('sponsor_2_spouse');
            // On page load
            if (sponsor2MaritalStatus.value=='MARRIED') {
                sponsor2spouseSection.hidden = false; // show
            } else {
                sponsor2spouseSection.hidden = true; // hide
            }

            // On sponsor2MaritalStatus change
            sponsor2MaritalStatus.addEventListener('change', function() {
                if (this.value=='MARRIED') {
                    sponsor2spouseSection.hidden = false; // show
                } else {
                    sponsor2spouseSection.hidden = true; // hide
                }
            })
        }
        let sponsor2spouseResidentialStatus = document.getElementById('id_sponsor_2_spouse_residential_status');
        if (sponsor2spouseResidentialStatus) {
            let sponsor2spouseIdNric = document.getElementById('sponsor2spouse_id_nric');
            let sponsor2spouseIdFin = document.getElementById('sponsor2spouse_id_fin');
            let sponsor2spouseIdPassport = document.getElementById('sponsor2spouse_id_passport');
            // On page load
            if (sponsor2spouseResidentialStatus.value=='SC' || sponsor2spouseResidentialStatus.value=='PR' ) {
                sponsor2spouseIdNric.hidden = false; // show
                sponsor2spouseIdFin.hidden = true; // hide
                sponsor2spouseIdPassport.hidden = true; // hide
            } else {
                sponsor2spouseIdNric.hidden = true; // hide
                sponsor2spouseIdFin.hidden = false; // show
                sponsor2spouseIdPassport.hidden = false; // show
            }

            // On sponsor2spouseResidentialStatus change
            sponsor2spouseResidentialStatus.addEventListener('change', function() {
                if (this.value=='SC' || this.value=='PR') {
                    sponsor2spouseIdNric.hidden = false; // show
                    sponsor2spouseIdFin.hidden = true; // hide
                    sponsor2spouseIdPassport.hidden = true; // hide
                } else {
                    sponsor2spouseIdNric.hidden = true; // hide
                    sponsor2spouseIdFin.hidden = false; // show
                    sponsor2spouseIdPassport.hidden = false; // show
                }
            })
        }

        // Joint Applicant create/update

        // Token URL copy
        let copyBtn = document.querySelector('#copy-button');
        if (copyBtn) {
            copyBtn.addEventListener('click', () => {
                let copyElement = document.getElementById("copy-id");
                navigator.clipboard.writeText(copyElement.value)
                    .then(() => {
                        // Animate copy button
                        copyElement.animate([
                            { transform: 'scale(1)' },
                            { transform: 'scale(1)', backgroundColor: '#666666', color: 'white', },
                            { transform: 'scale(1)' },
                        ], {
                            duration: 500, //milliseconds
                            easing: 'ease-in', //'linear', a bezier curve, etc.
                            delay: 0, //milliseconds
                            iterations: 1, //or a number
                            direction: 'normal', //'normal', 'reverse', etc.
                            fill: 'forwards' //'backwards', 'both', 'none', 'auto'
                        });
                    })
                    .catch(err => {
                        console.log('Error in copying text: ', err);
                    });
            })
        }
    </script>
{% endblock js %}
