{% extends 'dashboard-base.html' %}

{% block dashboard_section %}
    {% if form.errors %}
        {% for field in form %}
            {% for error in field.errors %}
            <div class="alert alert-danger">
                <strong>{{ error|escape }}</strong>
            </div>
            {% endfor %}
        {% endfor %}
    {% endif %}
    
    <div class="container">
        {% block form %}{% endblock form %}
    </div>
{% endblock dashboard_section %}

{% block js %}
    <script>
        let applicantType = document.getElementById('id_applicant_type');
        let employerMaritalStatus = document.getElementById('id_employer_marital_status');
        if (applicantType && employerMaritalStatus) {
            // On page load
            if (employerMaritalStatus=='MARRIED') {
                document.getElementById('spouse-section').hidden = false; // show
            } else {
                document.getElementById('spouse-section').hidden = true; // hide
            }

            // On employerMaritalStatus change
            employerMaritalStatus.addEventListener('change', function() {
                if (this.value=='MARRIED') {
                    document.getElementById('spouse-section').hidden = false; // show
                } else {
                    document.getElementById('spouse-section').hidden = true; // hide
                }
            })

            // On applicantType change
            applicantType.addEventListener('change', function() {
                if (this.value=='SPOUSE') {
                    document.getElementById('spouse-section').hidden = false; // show
                    employerMaritalStatus.value = 'MARRIED';
                }
            })
        }

        
        // Token URL copy
        let copyBtn = document.querySelector('#copy-button');
        if (copyBtn) {
            copyBtn.addEventListener('click', () => {
                let copyElement = document.getElementById("copy-id");
                navigator.clipboard.writeText(copyElement.value)
                    .then(() => {
                        // Animate copy button
                        copyElement.animate([
                            { transform: 'scale(1)' },
                            { transform: 'scale(1)', backgroundColor: '#666666', color: 'white', },
                            { transform: 'scale(1)' },
                        ], {
                            duration: 500, //milliseconds
                            easing: 'ease-in', //'linear', a bezier curve, etc.
                            delay: 0, //milliseconds
                            iterations: 1, //or a number
                            direction: 'normal', //'normal', 'reverse', etc.
                            fill: 'forwards' //'backwards', 'both', 'none', 'auto'
                        });
                    })
                    .catch(err => {
                        console.log('Error in copying text: ', err);
                    });
            })
        }
    </script>
{% endblock js %}
