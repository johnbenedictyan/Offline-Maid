{% extends 'employer_documentation/base-ed-template.html' %}

{% block css %}
<style>
    .custom-table-header, .custom-table-data, .custom-table-data-hidden {
        min-height: 2rem;
        padding: 0.8rem 1rem;
        border-top: 1px solid lightgrey;
    }
    .custom-table-header {
        background-color: steelblue;
        color: white;
        font-weight: bold;
    }
    .custom-table-dataset:nth-child(even) {
        background-color: #eee;
    }
    .custom-table-data-hidden {
        border-bottom: 1px solid lightgrey;
    }
    .clickable:hover {
        cursor: pointer;
        background-color: lightblue;
    }
    .fa-file-pdf {
        color: rgb(165, 0, 0);
    }
</style>
{% endblock css %}

{% block sidenav_extra %}
{% endblock sidenav_extra %}

{% block ed_section %}
<div class="mx-3 ml-md-0">
    <h1>{% if request.resolver_match.url_name == 'status_list_route' %}Status Summary{% elif request.resolver_match.url_name == 'sales_list_route' %}Sales Summary{% endif %}</h1>

    <form method="get">
        <div class="form-row">
            <div class="col-12 col-xl-6 input-group mb-3">
                <input type="search" name="search" class="form-control input-text" placeholder="Search case ref, employer name, email, mobile..." value="{{ request.GET.search }}">
                <div class="input-group-append">
                    <button class="btn btn-primary" type="submit"><i class="fa fa-search"></i></button>
                </div>
            </div>
            <div class="col-12 col-xl-6 input-group mb-3">
                <input type="text" onfocus="(this.type='date')" name="start_date" class="form-control input-text" value="{{ request.GET.start_date }}" placeholder="Date from">
                <input type="text" onfocus="(this.type='date')" name="end_date" class="form-control input-text" value="{{ request.GET.end_date }}" placeholder="Date to">
                <select name="sort_by">
                    <option value="agreement_date_asc" {% if request.GET.sort_by == 'agreement_date_asc' %}selected{% endif %}>Agmt Date Asc</option>
                    <option value="agreement_date_des" {% if not request.GET.sort_by or request.GET.sort_by == 'agreement_date_des' %}selected{% endif %}>Agmt Date Desc</option>
                    <option value="fdw_work_commencement_date_asc" {% if request.GET.sort_by == 'fdw_work_commencement_date_asc' %}selected{% endif %}>Work Commence Asc</option>
                    <option value="fdw_work_commencement_date_des" {% if request.GET.sort_by == 'fdw_work_commencement_date_des' %}selected{% endif %}>Work Commence Desc</option>
                </select>
                <div class="input-group-append">
                    <button class="btn btn-primary" type="submit"><i class="fa fa-search"></i></button>
                </div>
            </div>
        </div>
    </form>
</div>

<div class="custom-table">
    <div class="d-none d-xl-block">
        <!-- Display for xl screens and above -->
        <div class="row custom-table-header">
            <div class="col">Employer</div>
            <div class="col">Case No</div>
            <div class="col">Staff</div>
            <div class="col">FDW</div>
            <div class="col-3">
                <div class="row text-center">
                    <div class="col-12">Date</div>
                    <div class="col-6">Agreement</div>
                    <div class="col-6">Deployment</div>
                </div>
            </div>
            <div class="col-2">
                <div class="row">
                    <div class="col-12 text-center">Amount (S$)</div>
                    <div class="col-6">Deposit</div>
                    <div class="col-6">Balance</div>
                </div>
            </div>
            <div class="col">Action</div>
        </div>
    </div>
    <div class="row custom-table-body">
        {% if object_list.count %}
            {% for object in object_list %}
                <div class="col-12 custom-table-dataset">
                    <div class="clickable d-none d-xl-block">
                        <!-- Display for xl screens and above -->
                        <div class="row custom-table-data">
                            <div class="col">Name:&emsp;{{ object.employer.employer_name }}<br>NRIC:&emsp;{{ object.employer.get_nric_partial }}</div>
                            <div class="col">{{ object.case_ref_no }}</div>
                            <div class="col">{{ object.employer.agency_employee.ea_personnel_number }}<br>{{ object.employer.agency_employee.first_name }} {{ object.employer.agency_employee.last_name }}</div>
                            <div class="col">{{ object.fdw.reference_number }}<br>{{ object.fdw.name }}</div>
                            <div class="col-3">
                                <div class="row text-center">
                                    <div class="col">{{ object.agreement_date|date:"d M Y" }}</div>
                                    <div class="col">{% if object.rn_maidstatus_ed.fdw_work_commencement_date %}{{ object.rn_maidstatus_ed.fdw_work_commencement_date|date:"d M Y" }}{% else %}Add{% endif %}</div>
                                </div>
                            </div>
                            <div class="col-2">
                                <div class="row text-right">
                                    <div class="col">{{ object.ca_deposit }}</div>
                                    <div class="col">{{ object.calc_bal }}</div>
                                </div>
                            </div>
                            <div class="col">
                                <a class="btn btn-secondary btn-sm" href="{% url 'employer_payment_list_route' employer_pk=object.employer.pk employerdoc_pk=object.pk %}"><i class="fas fa-money-check-alt"></i></a>
                                <button type="button" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#deployFdwModal-{{ object.rn_maidstatus_ed.pk }}"><i class="fas fa-undo"></i></button> <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#archive-{{ object.rn_pdfarchive_ed.pk }}"><i class="fas fa-save"></i></button>
                                {% include 'employer_documentation/snippet_modal_deploy.html' %}
                                {% include 'employer_documentation/snippet_modal_archive.html' %}
                            </div>
                        </div>
                    </div>
                    <div class="clickable d-xl-none">
                        <!-- Display for lg screens and smaller -->
                        {% with class_col_left="col-6" class_col_right="col-6" %}
                        <div class="row custom-table-data">
                            <div class="{{ class_col_left }}">Employer</div>
                            <div class="{{ class_col_right }}">Name:&emsp;{{ object.employer.employer_name }}<br>NRIC:&emsp;{{ object.employer.get_nric_partial }}</div>
                        </div>
                        <div class="row custom-table-data">
                            <div class="{{ class_col_left }}">Case No</div>
                            <div class="{{ class_col_right }}">{{ object.case_ref_no }}</div>
                        </div>
                        <div class="row custom-table-data">
                            <div class="{{ class_col_left }}">Staff</div>
                            <div class="{{ class_col_right }}">{{ object.employer.agency_employee.ea_personnel_number }} {{ object.employer.agency_employee.first_name }} {{ object.employer.agency_employee.last_name }}</div>
                        </div>
                        <div class="row custom-table-data">
                            <div class="{{ class_col_left }}">FDW</div>
                            <div class="{{ class_col_right }}">{{ object.fdw.reference_number }} {{ object.fdw.name }}</div>
                        </div>
                        <div class="row custom-table-data">
                            <div class="{{ class_col_left }}">Agreement Date</div>
                            <div class="{{ class_col_right }}">{{ object.agreement_date|date:"d M Y" }}</div>
                        </div>
                        <div class="row custom-table-data">
                            <div class="{{ class_col_left }}">Deployment Date</div>
                            <div class="{{ class_col_right }}">{% if object.rn_maidstatus_ed.fdw_work_commencement_date %}{{ object.rn_maidstatus_ed.fdw_work_commencement_date|date:"d M Y" }}{% else %}Add{% endif %}</div>
                        </div>
                        <div class="row custom-table-data">
                            <div class="{{ class_col_left }}">Deposit Amount (S$)</div>
                            <div class="{{ class_col_right }}">{{ object.ca_deposit }}</div>
                        </div>
                        <div class="row custom-table-data">
                            <div class="{{ class_col_left }}">Balance Amount (S$)</div>
                            <div class="{{ class_col_right }}">{{ object.calc_bal }}</div>
                        </div>
                        <div class="row custom-table-data">
                            <div class="{{ class_col_left }}">Action</div>
                            <div class="{{ class_col_right }}">
                                <a class="btn btn-secondary btn-sm" href="{% url 'employer_payment_list_route' employer_pk=object.employer.pk employerdoc_pk=object.pk %}"><i class="fas fa-money-check-alt"></i></a>
                                <button type="button" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#deployFdwModal-{{ object.rn_maidstatus_ed.pk }}"><i class="fas fa-undo"></i></button><button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#archive-{{ object.rn_pdfarchive_ed.pk }}"><i class="fas fa-save"></i></button>
                                {% include 'employer_documentation/snippet_modal_deploy.html' %}
                                {% include 'employer_documentation/snippet_modal_archive.html' %}
                            </div>
                        </div>
                        {% endwith %}
                    </div>
                    <div class="row custom-table-data-hidden custom-table-dataset" hidden="True">
                        {% with class_row_wrapper="col-12 col-md-6 col-xl-4" class_col_left="col-10 col-md-9" class_col_right="col-2 col-md-3" %}
                        <div class="{{ class_row_wrapper }}">
                            <div class="row">
                                <div class="{{ class_col_left }}">Service Fee Schedule</div>
                                <div class="{{ class_col_right }}"><a href="{% url 'pdf_archive_service_fees' employer_pk=object.employer.pk employerdoc_pk=object.pk %}" target="_blank"><i class="far fa-file-pdf"></i></a></div>
                            </div>
                        </div>
                        <div class="{{ class_row_wrapper }}">
                            <div class="row">
                                <div class="{{ class_col_left }}">Service Agreement</div>
                                <div class="{{ class_col_right }}"><a href="{% url 'pdf_archive_service_agreement' employer_pk=object.employer.pk employerdoc_pk=object.pk %}" target="_blank"><i class="far fa-file-pdf"></i></a></div>
                            </div>
                        </div>
                        <div class="{{ class_row_wrapper }}">
                            <div class="row">
                                <div class="{{ class_col_left }}">Employment Contract</div>
                                <div class="{{ class_col_right }}"><a href="{% url 'pdf_archive_employment_contract' employer_pk=object.employer.pk employerdoc_pk=object.pk %}" target="_blank"><i class="far fa-file-pdf"></i></a></div>
                            </div>
                        </div>
                        <div class="{{ class_row_wrapper }}">
                            <div class="row">
                                <div class="{{ class_col_left }}">Repayment Schedule</div>
                                <div class="{{ class_col_right }}"><a href="{% url 'pdf_archive_repayment_schedule' employer_pk=object.employer.pk employerdoc_pk=object.pk %}" target="_blank"><i class="far fa-file-pdf"></i></a></div>
                            </div>
                        </div>
                        <div class="{{ class_row_wrapper }}">
                            <div class="row">
                                <div class="{{ class_col_left }}">Rest Day Agreement</div>
                                <div class="{{ class_col_right }}"><a href="{% url 'pdf_archive_rest_day_agreement' employer_pk=object.employer.pk employerdoc_pk=object.pk %}" target="_blank"><i class="far fa-file-pdf"></i></a></div>
                            </div>
                        </div>
                        <div class="{{ class_row_wrapper }}">
                            <div class="row">
                                <div class="{{ class_col_left }}">Handover Checklist</div>
                                <div class="{{ class_col_right }}"><a href="{% url 'pdf_archive_handover_checklist' employer_pk=object.employer.pk employerdoc_pk=object.pk %}" target="_blank"><i class="far fa-file-pdf"></i></a></div>
                            </div>
                        </div>
                        <div class="{{ class_row_wrapper }}">
                            <div class="row">
                                <div class="{{ class_col_left }}">Transfer Consent</div>
                                <div class="{{ class_col_right }}"><a href="{% url 'pdf_archive_transfer_consent' employer_pk=object.employer.pk employerdoc_pk=object.pk %}" target="_blank"><i class="far fa-file-pdf"></i></a></div>
                            </div>
                        </div>
                        <div class="{{ class_row_wrapper }}">
                            <div class="row">
                                <div class="{{ class_col_left }}">Work Pass Authorisation</div>
                                <div class="{{ class_col_right }}"><a href="{% url 'pdf_archive_work_pass_authorisation' employer_pk=object.employer.pk employerdoc_pk=object.pk %}" target="_blank"><i class="far fa-file-pdf"></i></a></div>
                            </div>
                        </div>
                        <div class="{{ class_row_wrapper }}">
                            <div class="row">
                                <div class="{{ class_col_left }}">Security Bond</div>
                                <div class="{{ class_col_right }}"><a href="{% url 'pdf_archive_security_bond' employer_pk=object.employer.pk employerdoc_pk=object.pk %}" target="_blank"><i class="far fa-file-pdf"></i></a></div>
                            </div>
                        </div>
                        <div class="{{ class_row_wrapper }}">
                            <div class="row">
                                <div class="{{ class_col_left }}">FDW Work Permit Application</div>
                                <div class="{{ class_col_right }}"><a href="{% url 'pdf_archive_fdw_work_permit' employer_pk=object.employer.pk employerdoc_pk=object.pk %}" target="_blank"><i class="far fa-file-pdf"></i></a></div>
                            </div>
                        </div>
                        <div class="{{ class_row_wrapper }}">
                            <div class="row">
                                <div class="{{ class_col_left }}">Income Tax Declaration</div>
                                <div class="{{ class_col_right }}"><a href="{% url 'pdf_archive_income_tax_declaration' employer_pk=object.employer.pk employerdoc_pk=object.pk %}" target="_blank"><i class="far fa-file-pdf"></i></a></div>
                            </div>
                        </div>
                        <div class="{{ class_row_wrapper }}">
                            <div class="row">
                                <div class="{{ class_col_left }}">Safety Agreement</div>
                                <div class="{{ class_col_right }}"><a href="{% url 'pdf_archive_safety_agreement' employer_pk=object.employer.pk employerdoc_pk=object.pk %}" target="_blank"><i class="far fa-file-pdf"></i></a></div>
                            </div>
                        </div>
                        {% endwith %}
                    </div>
                </div>
            {% endfor %}
        {% endif %}
    </div>
</div>

<!-- {% comment %}
<div>
    <table class="table table-hover">
        <thead>
            <tr>
                <th scope="col">Employer</th>
                <th scope="col">Case No</th>
                <th scope="col">Staff</th>
                <th scope="col">FDW</th>
                <th scope="col">Agreement Date</th>
                <th scope="col">Deployment</th>
                <th scope="col">Deposit</th>
                <th scope="col">Balance</th>
                <th scope="col">Archived</th>
                <th scope="col">Action</th>
            </tr>
        </thead>
        <tbody>
        {% if object_list.count %}
            {% for object in object_list %}
                <tr>
                    <td><a href="{% url 'employer_detail_route' employer_pk=object.employer.pk %}">{{ object.employer.employer_name }}</a></td>
                    <td><a href="{% url 'employerdoc_detail_route' employer_pk=object.employer.pk employerdoc_pk=object.pk %}">{{ object.case_ref_no }}</a></td>
                    <td><a href="{% url 'employer_detail_route' employer_pk=object.employer.pk %}">{{ object.employer.agency_employee.ea_personnel_number }} {{ object.employer.agency_employee.first_name }} {{ object.employer.agency_employee.last_name }}</a></td>
                    <td><a href="{% url 'maid_detail' pk=object.fdw.pk %}">{{ object.fdw.reference_number }} - {{ object.fdw.name }}</a></td>
                    <td><a href="{% url 'employerdoc_detail_route' employer_pk=object.employer.pk employerdoc_pk=object.pk %}">{{ object.agreement_date|date:"d M Y" }}</a></td>
                    <td><a href="{% url 'employerdoc_status_update_route' employer_pk=object.employer.pk employerdoc_pk=object.pk employersubdoc_pk=object.rn_maidstatus_ed.pk %}">{% if object.rn_maidstatus_ed.fdw_work_commencement_date %}{{ object.rn_maidstatus_ed.fdw_work_commencement_date|date:"d M Y" }}{% else %}Add{% endif %}</a></td>
                    <td><a href="">{{ object.ca_deposit }}</a></td>
                    <td><a href="">{{ object.calc_bal }}</a></td>
                    <td><a href="{% url 'pdf_archive_detail' employer_pk=object.employer.pk employerdoc_pk=object.pk %}"><i class="fas fa-archive"></i> View</a></td>
                    <td><button type="button" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#deployFdwModal-{{ object.rn_maidstatus_ed.pk }}"><i class="fas fa-undo"></i></button><button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#archive-{{ object.rn_pdfarchive_ed.pk }}"><i class="fas fa-save"></i></button></td>
                    {% include 'employer_documentation/snippet_modal_deploy.html' %}
                    {% include 'employer_documentation/snippet_modal_archive.html' %}
                </tr>
            {% endfor %}
        {% else %}
            <tr>
                <td colspan="10">No results found</td>
            </tr>
        {% endif %}
        </tbody>
    </table>
</div>
{% endcomment %} -->

<div class="mt-2 mb-4">
{% include 'pagination.html' %}
</div>
{% endblock ed_section %}

{% block js %}
<script>
    for (let clickable of document.getElementsByClassName('clickable')) {
        clickable.addEventListener('click', function() {
            let formerElement = document.querySelector('.custom-table-data-toggle');
            if (formerElement) {
                formerElement.classList.remove("custom-table-data-toggle");
                formerElement.hidden = true;
            }
            this.parentElement.children[this.parentElement.children.length-1].hidden = false;
            this.parentElement.children[this.parentElement.children.length-1].classList.add("custom-table-data-toggle");
        });
    }
</script>
{% endblock js %}
