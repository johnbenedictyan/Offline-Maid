{% extends 'employer_documentation/base-ed-template.html' %}

{% block sidenav_extra %}
<div class="row">
    <div class="col px-0">
        <a class="nav-link side-nav-link {% if url_name == 'employer_detail_route' %}active{% endif %}" href="{% url 'employer_detail_route' employer_pk=request.resolver_match.kwargs.employer_pk %}">
        <p class="m-1 pl-2">Employer Profile</p>
        </a>
    </div>
</div>
<div class="row">
    <div class="col px-0">
        <a class="nav-link side-nav-link {% if url_name == 'employer_update_route' %}active{% endif %}" href="{% url 'employer_update_route' employer_pk=request.resolver_match.kwargs.employer_pk %}">
        <p class="m-1 pl-2">Edit Employer</p>
        </a>
    </div>
</div>
<div class="row">
    <div class="col px-0">
        <a class="nav-link side-nav-link {% if url_name == 'employerdoc_list_route' %}active{% endif %}" href="{% url 'employerdoc_list_route' employer_pk=request.resolver_match.kwargs.employer_pk %}">
        <p class="m-1 pl-2">Documents Summary</p>
        </a>
    </div>
</div>
{% endblock sidenav_extra %}

{% block ed_section %}
    <h2>Payment Transactions</h2>
    {% if object_list.count %}
        <h4>{{ object_list.0.employer_doc.employer.employer_name }}</h4>
        <h4>{{ object_list.0.employer_doc.employer.mobile_format_sg }}</h4>
    {% endif %}

    <div class="d-flex row justify-content-end mx-0 pr-3 pb-3">
        <a href="{% url 'employer_payment_create_route' employer_pk=request.resolver_match.kwargs.employer_pk employerdoc_pk=request.resolver_match.kwargs.employerdoc_pk %}" class="btn btn-secondary btn-sm">Add transaction</a>
    </div>

    <table class="table table-hover">
        <thead>
            <tr>
                <th scope="col">Date</th>
                <th scope="col">Description</th>
                <th scope="col">Amount</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>{{ object_list.0.employer_doc.agreement_date|date:"d M Y" }}</td>
                <td>Total admin cost</td>
                <td>{{ object_list.0.employer_doc.calc_admin_cost }}</td>
            </tr>
            <tr>
                <td>{{ object_list.0.employer_doc.agreement_date|date:"d M Y" }}</td>
                <td>FDW agency fee</td>
                <td>{{ object_list.0.employer_doc.fdw.financial_details.agency_fee_amount }}</td>
            </tr>
            <tr>
                <td>{{ object_list.0.employer_doc.agreement_date|date:"d M Y" }}</td>
                <td>FDW personal loan</td>
                <td>{{ object_list.0.employer_doc.fdw.financial_details.personal_loan_amount }}</td>
            </tr>
            <tr>
                <td>{{ object_list.0.employer_doc.agreement_date|date:"d M Y" }}</td>
                <td>Deposit paid</td>
                <td>&ndash; {{ object_list.0.employer_doc.ca_deposit }}</td>
            </tr>
        {% if object_list.count %}
            {% for object in object_list %}
            <tr>
                <td>{{ object.transaction_date|date:"d M Y" }}</td>
                <td>{{ object.get_transaction_type_display }}</td>
                <td>{% if object.transaction_type == 'SUB' %}&ndash; {% endif %}{{ object.amount }}</td>
            </tr>
            {% endfor %}
            <tr style="border-top: solid 2px black;">
                <td colspan="2">Amount outstanding</td>
                <td>{{ object_list.0.employer_doc.calc_bal }}</td>
            </tr>
        {% else %}
            <tr>
                <td colspan="6">No results found. Click <a href="{% url 'employer_payment_create_route' employer_pk=request.resolver_match.kwargs.employer_pk employerdoc_pk=request.resolver_match.kwargs.employerdoc_pk %}">here</a> to add transaction.</td>
            </tr>
        {% endif %}
        </tbody>
    </table>
{% endblock ed_section %}