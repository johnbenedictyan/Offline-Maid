{% extends 'employer_documentation/base-ed-template.html' %}

{% block sidenav_extra %}
{% endblock sidenav_extra %}

{% block ed_section %}
<div class="mx-3 ml-md-0">
    <h1>Status Summary</h1>

    <form method="get">
        <div class="form-row">
            <div class="col-md-6 input-group mb-3">
                <input type="search" name="search" class="form-control input-text" placeholder="Search case ref, employer name, NRIC, email, mobile..." value="{{ request.GET.search }}">
                <div class="input-group-append">
                    <button class="btn btn-primary" type="submit"><i class="fa fa-search"></i></button>
                </div>
            </div>
        </div>
        <div class="form-row">
            <div class="col-md-6 input-group mb-3">
                <input type="text" onfocus="(this.type='date')" name="start_date" class="form-control input-text" value="{{ request.GET.start_date }}" placeholder="Date from">
                <input type="text" onfocus="(this.type='date')" name="end_date" class="form-control input-text" value="{{ request.GET.end_date }}" placeholder="Date to">
                <select name="sort_by">
                    <option value="agreement_date_asc" {% if request.GET.sort_by == 'agreement_date_asc' %}selected{% endif %}>Agmt Date Asc</option>
                    <option value="agreement_date_des" {% if not request.GET.sort_by or request.GET.sort_by == 'agreement_date_des' %}selected{% endif %}>Agmt Date Desc</option>
                    <option value="ipa_date_asc" {% if request.GET.sort_by == 'ipa_date_asc' %}selected{% endif %}>IPA Date Asc</option>
                    <option value="ipa_date_des" {% if request.GET.sort_by == 'ipa_date_des' %}selected{% endif %}>IPA Date Desc</option>
                </select>
                <div class="input-group-append">
                    <button class="btn btn-primary" type="submit"><i class="fa fa-search"></i></button>
                </div>
            </div>
        </div>
    </form>
</div>

<div>
    <table class="table table-hover">
        <thead>
            <tr>
                <th scope="col">Employer</th>
                <th scope="col">Case Ref</th>
                <th scope="col">FDW</th>
                <th scope="col">Agreement Date</th>
                <th scope="col">IPA Date</th>
                <th scope="col">Bond Date</th>
                <th scope="col">Arrival Date</th>
                <th scope="col">Thumb Print Date</th>
                <th scope="col">SIP Date</th>
                <th scope="col">Work Permit</th>
                <th scope="col">Work Commence</th>
                <th scope="col">Action</th>
            </tr>
        </thead>
        <tbody>
        {% if object_list.count %}
            {% for object in object_list %}
                <tr>
                    <td><a href="{% url 'employer_detail_route' employer_pk=object.employer.pk %}">{{ object.employer.employer_name }}</a></td>
                    <td><a href="{% url 'employerdoc_detail_route' employer_pk=object.employer.pk employerdoc_pk=object.pk %}">{{ object.case_ref_no }}</a></td>
                    <td><a href="{% url 'maid_detail' pk=object.fdw.pk %}">{{ object.fdw.reference_number }} - {{ object.fdw.biodata.name }}</a></td>
                    <td><a href="{% url 'employerdoc_detail_route' employer_pk=object.employer.pk employerdoc_pk=object.pk %}">{{ object.agreement_date|date:"d M Y" }}</a></td>
                    <td><a href="{% url 'employerdoc_status_update_route' employer_pk=object.employer.pk employerdoc_pk=object.pk employersubdoc_pk=object.rn_maidstatus_ed.pk %}">{% if object.rn_maidstatus_ed.ipa_approval_date|date:"d/m/y" %}{{ object.rn_maidstatus_ed.ipa_approval_date|date:"d/m/y" }}{% else %}Add{% endif %}</a></td>
                    <td><a href="{% url 'employerdoc_status_update_route' employer_pk=object.employer.pk employerdoc_pk=object.pk employersubdoc_pk=object.rn_maidstatus_ed.pk %}">{% if object.rn_maidstatus_ed.security_bond_approval_date|date:"d/m/y" %}{{ object.rn_maidstatus_ed.security_bond_approval_date|date:"d/m/y" }}{% else %}Add{% endif %}</a></td>
                    <td><a href="{% url 'employerdoc_status_update_route' employer_pk=object.employer.pk employerdoc_pk=object.pk employersubdoc_pk=object.rn_maidstatus_ed.pk %}">{% if object.rn_maidstatus_ed.arrival_date|date:"d/m/y" %}{{ object.rn_maidstatus_ed.arrival_date|date:"d/m/y" }}{% else %}Add{% endif %}</a></td>
                    <td><a href="{% url 'employerdoc_status_update_route' employer_pk=object.employer.pk employerdoc_pk=object.pk employersubdoc_pk=object.rn_maidstatus_ed.pk %}">{% if object.rn_maidstatus_ed.thumb_print_date|date:"d/m/y" %}{{ object.rn_maidstatus_ed.thumb_print_date|date:"d/m/y" }}{% else %}Add{% endif %}</a></td>
                    <td><a href="{% url 'employerdoc_status_update_route' employer_pk=object.employer.pk employerdoc_pk=object.pk employersubdoc_pk=object.rn_maidstatus_ed.pk %}">{% if object.rn_maidstatus_ed.sip_date|date:"d/m/y" %}{{ object.rn_maidstatus_ed.sip_date|date:"d/m/y" }}{% else %}Add{% endif %}</a></td>
                    <td><a href="{% url 'employerdoc_status_update_route' employer_pk=object.employer.pk employerdoc_pk=object.pk employersubdoc_pk=object.rn_maidstatus_ed.pk %}">{% if object.rn_maidstatus_ed.work_permit_no %}{{ object.rn_maidstatus_ed.work_permit_no }}{% else %}Add{% endif %}</a></td>
                    <td><a href="{% url 'employerdoc_status_update_route' employer_pk=object.employer.pk employerdoc_pk=object.pk employersubdoc_pk=object.rn_maidstatus_ed.pk %}">{% if object.rn_maidstatus_ed.fdw_work_commencement_date %}{{ object.rn_maidstatus_ed.fdw_work_commencement_date|date:"d M Y" }}{% else %}Add{% endif %}</a></td>
                    <td><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#deployFdwModal-{{ forloop.counter }}">Deploy</button></td>
                </tr>

                <!-- Modal -->
                <div class="modal fade" id="deployFdwModal-{{ forloop.counter }}" tabindex="-1" aria-labelledby="deployFdwModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Confirm FDW Deployment</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            </div>
                            <div class="modal-body">
                                <p>Please confirm FDW has been deployed to employer.</p>
                                <p>After deployment confirmation, case will be moved to sales summary.</p>
                            </div>
                            <div class="modal-footer">
                                <form action="{% url 'employerdoc_deployment_update_route' employer_pk=object.employer.pk employerdoc_pk=object.pk employersubdoc_pk=object.rn_maidstatus_ed.pk %}" method="post">
                                    {% csrf_token %}
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <input type="submit" class="btn btn-primary" value="Deploy">
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <tr>
                <td colspan="11">No results found</td>
            </tr>
        {% endif %}
        </tbody>
    </table>
</div>

<div class="mt-2 mb-4">
{% include 'pagination.html' %}
</div>
{% endblock ed_section %}