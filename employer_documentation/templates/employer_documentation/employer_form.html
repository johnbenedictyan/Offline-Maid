{% extends 'dashboard-base.html' %}

{% block dashboard_section %}
    {% if form.errors %}
        {% for field in form %}
            {% for error in field.errors %}
            <div class="alert alert-danger">
                <strong>{{ error|escape }}</strong>
            </div>
            {% endfor %}
        {% endfor %}
    {% endif %}
    
    <div class="container">
        {% block form %}{% endblock form %}
    </div>
{% endblock dashboard_section %}

{% block js %}
    <script>
        // Employer create/update
        let applicantType = document.getElementById('id_applicant_type');
        let employerMaritalStatus = document.getElementById('id_employer_marital_status');
        if (applicantType && employerMaritalStatus) {
            let spouseSection = document.getElementById('spouse-section');
            // On page load
            if (employerMaritalStatus.value=='MARRIED') {
                spouseSection.hidden = false; // show
            } else {
                spouseSection.hidden = true; // hide
            }

            // On employerMaritalStatus change
            employerMaritalStatus.addEventListener('change', function() {
                if (this.value=='MARRIED') {
                    spouseSection.hidden = false; // show
                } else {
                    spouseSection.hidden = true; // hide
                }
            })

            // On applicantType change
            applicantType.addEventListener('change', function() {
                if (this.value=='SPOUSE') {
                    spouseSection.hidden = false; // show
                    employerMaritalStatus.value = 'MARRIED';
                }
            })
        }
        let employerResidentialStatus = document.getElementById('id_employer_residential_status');
        if (employerResidentialStatus) {
            let employerIdNric = document.getElementById('employer_id_nric');
            let employerIdOther = document.getElementById('employer_id_other');
            // On page load
            if (employerResidentialStatus.value=='SC' || employerResidentialStatus.value=='PR' ) {
                employerIdNric.hidden = false; // show
                employerIdOther.hidden = true; // hide
            } else {
                employerIdNric.hidden = true; // hide
                employerIdOther.hidden = false; // show
            }

            // On employerResidentialStatus change
            employerResidentialStatus.addEventListener('change', function() {
                if (this.value=='SC' || this.value=='PR') {
                    employerIdNric.hidden = false; // show
                    employerIdOther.hidden = true; // hide
                } else {
                    employerIdNric.hidden = true; // hide
                    employerIdOther.hidden = false; // show
                }
            })

        }
        let spouseResidentialStatus = document.getElementById('id_spouse_residential_status');
        if (spouseResidentialStatus) {
            let spouseIdNric = document.getElementById('spouse_id_nric');
            let spouseIdOther = document.getElementById('spouse_id_other');
            // On page load
            if (spouseResidentialStatus.value=='SC' || spouseResidentialStatus.value=='PR' ) {
                spouseIdNric.hidden = false; // show
                spouseIdOther.hidden = true; // hide
            } else {
                spouseIdNric.hidden = true; // hide
                spouseIdOther.hidden = false; // show
            }

            // On spouseResidentialStatus change
            spouseResidentialStatus.addEventListener('change', function() {
                if (this.value=='SC' || this.value=='PR') {
                    spouseIdNric.hidden = false; // show
                    spouseIdOther.hidden = true; // hide
                } else {
                    spouseIdNric.hidden = true; // hide
                    spouseIdOther.hidden = false; // show
                }
            })

        }

        // Sponsor create/update

        // Joint Applicant create/update

        // Token URL copy
        let copyBtn = document.querySelector('#copy-button');
        if (copyBtn) {
            copyBtn.addEventListener('click', () => {
                let copyElement = document.getElementById("copy-id");
                navigator.clipboard.writeText(copyElement.value)
                    .then(() => {
                        // Animate copy button
                        copyElement.animate([
                            { transform: 'scale(1)' },
                            { transform: 'scale(1)', backgroundColor: '#666666', color: 'white', },
                            { transform: 'scale(1)' },
                        ], {
                            duration: 500, //milliseconds
                            easing: 'ease-in', //'linear', a bezier curve, etc.
                            delay: 0, //milliseconds
                            iterations: 1, //or a number
                            direction: 'normal', //'normal', 'reverse', etc.
                            fill: 'forwards' //'backwards', 'both', 'none', 'auto'
                        });
                    })
                    .catch(err => {
                        console.log('Error in copying text: ', err);
                    });
            })
        }
    </script>
{% endblock js %}
